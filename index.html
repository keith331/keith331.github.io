
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Keith's note</title>
  <meta name="author" content="Keith">

  
  <meta name="description" content="Check status cat /proc/mdstator watch -n 0.2 cat /proc/mdstat If it's successful that will be 1
2
3
4
5
6
7
8
Personalities : [linear] [multipath] [ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://keith331.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Keith's note" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Keith's note</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="keith331.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/01/06/ubuntu-softraid/">Ubuntu SoftRaid</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-01-06T14:58:55+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>2:58 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Check status</h3>


<p><code>cat /proc/mdstat</code>or <code>watch -n 0.2 cat /proc/mdstat</code></p>

<p>If it's successful that will be</p>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Personalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10]
</span><span class='line'>md1 : active raid1 sda5[0] sdb5[1]
</span><span class='line'>      16697216 blocks super 1.2 [2/2] [UU]
</span><span class='line'>
</span><span class='line'>md0 : active raid1 sdb1[1]
</span><span class='line'>      959923008 blocks super 1.2 [2/1] [_U]
</span><span class='line'>
</span><span class='line'>unused devices: &lt;none></span></code></pre></td></tr></table></div></figure>


<h3>Fdisk Hdd</h3>


<p>
<code>sfdisk -d /dev/sda | sfdisk /dev/sdb</code></p>

<p>the partition of sdb separate the same like sda</p>


<h3>Remove the failed HDD</h3>


<p><code>mdadm /dev/md0 &ndash;remove /dev/sda1</code></p>

<h3>Add a new HDD</h3>


<p><code>mdadm /dev/md0 &ndash;add /dev/sda1</code></p>

<h3>Stop raid</h3>


<p><code>mdadm &ndash;stop /dev/md0</code></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/01/04/using-extundelete-recover-deleted-files/">Using Extundelete Recover Deleted Files</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-01-04T14:00:13+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>2:00 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Install extundelete</h3>


<p></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install extundelete</span></code></pre></td></tr></table></div></figure>


<h3>Start to restore file</h3>


<p>We need to know the inode of directory where the deleted file, eg./home/rulingcom/designer/Onepiece  use this command 
</p>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls -id /home/rulingcom/designer</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/extundelete_1.png"><p></p>

<p>finding which devise that this directory is using </p>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>df /home/rulingcom/designer</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/extundelete_2.png"><p></p>

<p>so this directory in /dev/sdb1 then lets look</p>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo extundelete /dev/sdb1 --inode 2229439</span></code></pre></td></tr></table></div></figure>


<p>The deleted files must be on the list</p>


<p><img src="/images/extundelete_3.png"><p></p>

<p>If resoring go successful the file will be put on "RECOVERD_FILES" folder</p>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo extundelete /dev/sdb1 --restore-file /home/rulingcom/designer/Onepiece</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/extundelete_4.png"><p></p>

<h3>Start to restore director</h3>


<p>Changing the command "--restore-file" to "--restore-director"</p>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/12/21/rsnapshot-an-zhuang-yu-shi-yong-fang-shi/">How to Use Rsnapshot on Ubuntu</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-12-21T13:57:42+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2016</span></span> <span class='time'>1:57 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Install rsnapshot</h3>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install rsnapshot</span></code></pre></td></tr></table></div></figure>


<h3>Configuring Rsnapshot</h3>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo nano /etc/rsnapshot.conf</span></code></pre></td></tr></table></div></figure>


<p>The first decision you will need to make is where you would like to store your backups. We will use the directory “/backup” as our backup location. Search for and edit the following variable to set the backup location.</p>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>snapshot_root             /backup/</span></code></pre></td></tr></table></div></figure>


<p>We set these up under the “BACKUP INTERVALS” section of the configuration. We tell rsnapshot to retain a specific number of backups of each kind of interval.</p>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#########################################
</span><span class='line'>#           BACKUP INTERVALS            #
</span><span class='line'># Must be unique and in ascending order #
</span><span class='line'># i.e. hourly, daily, weekly, etc.      #
</span><span class='line'>#########################################
</span><span class='line'>
</span><span class='line'>retain        hourly  6
</span><span class='line'>retain        daily   7
</span><span class='line'>retain        weekly  4
</span><span class='line'>retain        monthly 3</span></code></pre></td></tr></table></div></figure>




<p>We will choose to backup the home directory and the etc directory.</p>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>###############################
</span><span class='line'>### BACKUP POINTS / SCRIPTS ###
</span><span class='line'>###############################
</span><span class='line'>
</span><span class='line'># LOCALHOST
</span><span class='line'>backup  /home/          localhost/</span></code></pre></td></tr></table></div></figure>




<h3>Testing Your Configuration</h3>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo rsnapshot configtest</span></code></pre></td></tr></table></div></figure>


<p>If your file is error-free, you will receive a “Syntax OK” message. If you did not receive this message, you need to go back and fix the mistakes that it tells you about.

Next, we want to perform a dry run of one of the snapshot to make sure we are producing the expected results. We use the "hourly" parameter because hourly backups are the basic snapshot type that the other intervals will build off of. That means that we will get more information from "hourly" than if we had choosen "daily" or "weekly".</p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo rsnapshot -t hourly</span></code></pre></td></tr></table></div></figure>




<p>If the generated output looks correct, you can remove the “-t” option to try your setup for the first time.</p>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo rsnapshot hourly</span></code></pre></td></tr></table></div></figure>




<h3>Automating the Process</h3>


<p>With rsnapshot working correctly, the only thing left to do is to schedule it to run at certain intervals. We will use cron, a linux scheduler, to make this happen.
</p>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo nano /etc/cron.d/rsnapshot</span></code></pre></td></tr></table></div></figure>




<p>The scheduling is currently commented out. We’re going to remove the “#” character from the beginning of the scheduling section to activate these values.</p>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># This is a sample cron file for rsnapshot.
</span><span class='line'># The values used correspond to the examples in /etc/rsnapshot.conf.
</span><span class='line'># There you can also set the backup points and many other things.
</span><span class='line'>#
</span><span class='line'># To activate this cron file you have to uncomment the lines below.
</span><span class='line'># Feel free to adapt it to your needs.
</span><span class='line'>
</span><span class='line'>0 */4         * * *           root    /usr/bin/rsnapshot hourly
</span><span class='line'>30 3          * * *           root    /usr/bin/rsnapshot daily
</span><span class='line'>0  3          * * 1           root    /usr/bin/rsnapshot weekly
</span><span class='line'>30 2          1 * *           root    /usr/bin/rsnapshot monthly</span></code></pre></td></tr></table></div></figure>




<p>These settings will run add a snapshot to the “hourly” directory within our “/backup/” directory every four hours, add a daily snapshot everyday at 3:30 am, add a weekly snapshot every Monday at 3:00 am, and add a monthly snapshot on the first of every month at 2:30 am.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/10/20/ubuntuxia-shi-yong-lsyncdtong-bu-zi-liao-jia/">Ubuntu下使用lsyncd同步資料夾</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-10-20T16:18:17+08:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>4:18 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h4>lsyncd一般用來同步備份資料夾，亦可以做到異機的同步，先下載安裝。</h4>


<p></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>apt-get install lsyncd</span></code></pre></td></tr></table></div></figure>


<h4>安裝之後，一些目錄必須手動建立</h4>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir /etc/lsyncd
</span><span class='line'>touch /etc/lsyncd/lsyncd.conf.lua</span></code></pre></td></tr></table></div></figure>


<h4>編輯lsyncd.conf.lua</h4>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>settings {
</span><span class='line'>    logfile = "/var/log/lsyncd/lsyncd.log",
</span><span class='line'>    statusFile = "/var/log/lsyncd/lsyncd.status",
</span><span class='line'>    delay = 0,
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>sync {
</span><span class='line'>    default.rsyncssh,
</span><span class='line'>    source = "/home/ubuntu/xxx/public/uploads",       #來源機的目錄
</span><span class='line'>    host = "ubuntu@10.1.0.103",       #備份機位置
</span><span class='line'>    targetdir = "/home/ubuntu/xxx/public/uploads",        #備份機的目錄
</span><span class='line'>    delete = true,
</span><span class='line'>    rsync = {
</span><span class='line'>         rsh="ssh -l ubuntu -i /home/ubuntu/xxx_key.pem -o StrictHostKeyChecking=no",
</span><span class='line'>    }  #ssh另一台主機,並關掉確認指訊息
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h4>再到/var/log目錄下建立上述定義的檔名</h4>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir /var/log/lsyncd
</span><span class='line'>touch /var/log/lsyncd/lsyncd.log
</span><span class='line'>touch /var/log/lsyncd/lsyncd.status</span></code></pre></td></tr></table></div></figure>


<h4>lsyncd 透過 inotify 作為監測目錄寫入的機制</h4>


<p>而 inotify 可監測的數量則受到 fs.inotify.max_user_watches 這個參數的限制。如果 lsyncd 欲監測的目錄數量超過系統的上限，並不會出現錯誤訊息，而是多餘的目錄直接被忽略。為了避免此一現象的發生，所以在<code>vim /etc/sysctl.conf</code>看看是否有以下的配置額</p>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>fs.inotify.max_user_watches = 999999</span></code></pre></td></tr></table></div></figure>


<p>設完好<code>sudo sysctl -p</code></p>

<h4>之後重啟服務</h4>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>service lsyncd restart</span></code></pre></td></tr></table></div></figure>


<h4>同步狀態，可輸入查看</h4>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ps aux | grep [l]syncd</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/10/13/ubuntu-env-install/">Ubuntu ENV Install</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-10-13T11:35:18+08:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>11:35 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Import MongoDB public key</h3>


<ul>
    <li>sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 7F0CEB10</li>
    <li>sudo echo 'deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen' | sudo tee /etc/apt/sources.list.d/mongodb.list</li>
</ul>


<h3>Install Dependencies</h3>


<ul>
    <li>sudo apt-get update</li>
    <li>sudo apt-get -y upgrade</li>
    <li>sudo apt-get install -y nginx git-core mongodb-org imagemagick curl openssh-server nano</li>
    <li>sudo apt-get --no-install-recommends --yes install gawk g++ gcc make libc6-dev libreadline6-dev zlib1g-dev libssl-dev libyaml-dev libsqlite3-dev sqlite3 autoconf libgdbm-dev libncurses5-dev automake libtool bison pkg-config libffi-dev</li>
</ul>


<h3>Install RVM and Ruby</h3>


<ul>
    <li>\curl -sSL https://get.rvm.io | bash -s stable</li>
    <li>source $HOME/.rvm/scripts/rvm</li>
    <li>rvm install 2.1 --default</li>
    <li>echo "gem: --no-ri --no-rdoc" > ~/.gemrc</li>
    <li>gem install bundler</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/08/11/ruo-dian-sao-miao/">弱點掃描</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-08-11T17:01:54+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>5:01 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Brakeman</h3>


<p>Brakeman是一款專門面向Ruby on Rails應用程式的漏洞掃描工具，同時也針對程序中一部分數值向另一部分傳遞的流程執行數據流分析。無需安裝整套應用程式即可使用該軟體</p>


<h4>gem install</h4>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem install brakeman</span></code></pre></td></tr></table></div></figure>


<h4>指定結果輸出的文件(全部掃描)</h4>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd your_rails_app/
</span><span class='line'>brakeman -o output.html</span></code></pre></td></tr></table></div></figure>


<h4>也可以不掃描指定檔案如helper</h4>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brakeman --skip-files application_helper.rb --ignore-model-output -o brakeman_adm.html</span></code></pre></td></tr></table></div></figure>


<h4>打開該文件即可對有問題的地方作修正，點選message可以看詳細內容</h4>


<p><img src="images/brakeman.png"></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/08/02/ubuntucao-zuo-bi-ji/">Ubuntu操作筆記</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-08-02T17:23:37+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2016</span></span> <span class='time'>5:23 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h4>Precompile</h4>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>RAILS_ENV=production bundle exec rake assets:precompile</span></code></pre></td></tr></table></div></figure>


<h4>停止網站</h4>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kill -s TERM `cat tmp/pids/unicorn.pid`</span></code></pre></td></tr></table></div></figure>


<h4>啟動網站Production模式</h4>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bundle exec unicorn_rails -c config/unicorn.rb -D -E production</span></code></pre></td></tr></table></div></figure>


<h4>重啟網站</h4>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kill -s USR2 `cat tmp/pids/unicorn.pid`</span></code></pre></td></tr></table></div></figure>


<h4>/var/log/nginx 查看log</h4>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tail -f access.log</span></code></pre></td></tr></table></div></figure>


<h4>查看cpu</h4>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /proc/cpuinfo | grep processor | wc -l</span></code></pre></td></tr></table></div></figure>


<h4>nginx轉址：以本地網址加/green為例，轉到http://XXX/green/，在nginx設定加入以下</h4>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>location /green/ {
</span><span class='line'>   rewrite ^ http://XXX/green/ permanent;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h4>網址設定不接受副檔名，在nginx設定中加註</h4>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>location ~* \.(bak|zip|rar|exe)$|/\. {
</span><span class='line'>    deny all;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/06/23/searchkick/">Searchkick</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-06-23T13:51:31+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2016</span></span> <span class='time'>1:51 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>step1</p>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brew install elasticsearch
</span><span class='line'>brew info elasticsearch</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/searchkick/1.png"><br></p>

<p>step2:Start the server than go to localhost:9200 .You should see some code</p>


<p>step3:Add searchkick to models you want to search.</p>


<p><img src="/images/searchkick/2.png"></p>

<p>step4:Add data to the search index.</p>


<p><code>Product.reindex</code>
<code>rake searchkick:reindex CLASS=Movie</code></p>

<p>For instance</p>


<p><code>rake searchkick:reindex CLASS=Movie</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;%= form_tag search_movies_path, method: :get, class:"navbar-form navbar-right" do %>
</span><span class='line'>  &lt;p>
</span><span class='line'>    &lt;%= text_field_tag :search, params[:search], class:"form-control" %>
</span><span class='line'>    &lt;%= submit_tag "Search", name: nil, class:"btn btn-default" %>
</span><span class='line'>  &lt;/p>
</span><span class='line'>&lt;% end %></span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>view </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def search
</span><span class='line'>  if params[:search].present?
</span><span class='line'>    @movies = Movie.search(params[:search])
</span><span class='line'>  else
</span><span class='line'>    @movies = Movie.all
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/06/22/raty-jqery/">Raty JQery</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-06-22T17:26:06+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2016</span></span> <span class='time'>5:26 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h4>評分星星功能</h4>


<p>step1:copy jqerty.raty.js and image of star to [javascript] [image]</p>


<p>step2: view
<code> div class="star-rating" data-score= "xx"> </code>
paste the following code:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;script>
</span><span class='line'>  $('.star-rating').raty ({
</span><span class='line'>    path: '/assets/',
</span><span class='line'>    readOnly: true,
</span><span class='line'>    score: function() {
</span><span class='line'>      return $(this).attr('data-score');
</span><span class='line'>    }
</span><span class='line'>  });
</span><span class='line'>&lt;/script></span></code></pre></td></tr></table></div></figure>
</p>


<p>step3: form  for example:</p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div class="field">
</span><span class='line'>    &lt;div id="star-rating">&lt;/div>
</span><span class='line'>  &lt;/div>
</span><span class='line'>  &lt;div class="field">
</span><span class='line'>    &lt;%= f.label :comment %>&lt;br>
</span><span class='line'>    &lt;%= f.text_area :comment %>
</span><span class='line'>  &lt;/div>
</span><span class='line'>  &lt;div class="actions">
</span><span class='line'>    &lt;%= f.submit %>
</span><span class='line'>  &lt;/div>
</span><span class='line'>&lt;% end %>
</span><span class='line'>
</span><span class='line'>&lt;script>
</span><span class='line'>  $('#star-rating').raty ({
</span><span class='line'>    path: '/assets/',
</span><span class='line'>    scoreName: '[review[rating]'
</span><span class='line'>  });
</span><span class='line'>&lt;/script></span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/05/24/jian-li-amazon-ec2-mian-fei-zhu-ji/">建立 Amazon EC2 免費主機</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-05-24T10:33:38+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>10:33 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>申請帳號</h3>


<p><a href="http://aws.amazon.com/tw/free/">http://aws.amazon.com/tw/free/</a></p>

<h3>建立免費AWS主機</h3>


<p>1.點選左上方的<code>services</code>選擇<code>EC2</code>服務：
<img src="/images/aws_ec2_1.png"><p>
2.選擇機房位置，可以選台灣連線速度最佳的日本Tokyo或新加坡<code></code>Singapore
<img src="/images/aws_ec2_2.png"><p>&lt;
3.選完地區後，點選左側<code>Instance</code>再點選<code>Launch Instance</code>進入建立主機的步驟：
<img src="/images/aws_ec2_3.png"><p>
4.選擇你要的作業系統，這裡我選Ubuntu Server 12.04.3 LTS
<img src="/images/aws_ec2_4.png"><p>
5.主機類型Instance Type請選擇免費的T2.micro
<img src="/images/aws_ec2_5.png"><p>
6.其它步驟可忽略直接跳過，直接進入設定防火牆的確認，請確認SSH有開放，之後才能登入
<img src="/images/aws_ec2_6.png"><p>
7.最後確認主機沒問題後點選<code>Launch</code>啟動主機：
<img src="/images/aws_ec2_7.png"><p>
8.接著會彈出一個視窗，請選擇<code>Create a new key pair</code>，然後隨意輸入一個名字在<code>Key pair name </code>欄位，接著點選<code>Download Key Pair</code>，將下載的key收好，待會要用這把key登入你的主機，下載完後點選<code> Launch Instance</code>啟動主機：<p>
<img src="/images/aws_ec2_8.png"><p></p>

<h3>登入AWS主機</h3>


<p>1.點選剛剛建立完成的主機，找到Public IP把它複製下來
<img src="/images/aws_ec2_9.png"><p>
2.開啟終端機，輸入</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh -i ~/路徑/密鑰名稱.pem 使用這名稱@IP</span></code></pre></td></tr></table></div></figure>


<p>3.UNPROTECTED PRIVATE KEY FILE，初次使用 Key Pair 登入 EC2 可能會遇到這個警告
通常是因為這個鑰匙檔的權限太過於公開
<img src="/images/aws_ec2_10.png"><p>
輸入以下可以解決</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chmod 400  ~/路徑/密鑰名稱.pem</span></code></pre></td></tr></table></div></figure>




<h3>將key加入</h3>


<p>ssh/id_rsa.pub內容 加到server下 authorized_keys 之後就不用輸入key</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/01/06/ubuntu-softraid/">Ubuntu SoftRaid</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/01/04/using-extundelete-recover-deleted-files/">Using Extundelete Recover Deleted Files</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/21/rsnapshot-an-zhuang-yu-shi-yong-fang-shi/">How to Use Rsnapshot on Ubuntu</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/10/20/ubuntuxia-shi-yong-lsyncdtong-bu-zi-liao-jia/">Ubuntu下使用lsyncd同步資料夾</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/10/13/ubuntu-env-install/">Ubuntu ENV Install</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Keith -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
